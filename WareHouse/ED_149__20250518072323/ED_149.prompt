Define the function 'max_happiness(N: int, M: int, A: List[int]) -> int' to calculate the maximum happiness after M handshakes. Parse the input to extract the values of N, M, and the list A of powers of the ordinary guests. Initialize a variable 'happiness' to 0 to keep track of the total happiness. Create a set to store unique handshakes to ensure no handshake is repeated. Iterate through all possible pairs of guests (x, y) to calculate the happiness for each handshake. For each unique pair (x, y), check if the handshake has already been performed using the set. If the handshake is unique, add the happiness from this handshake (A[x] + A[y]) to the total 'happiness'. Continue this process until M unique handshakes have been performed or all pairs have been considered. Return the total 'happiness' as the output of the function. Ensure the output format is an integer representing the maximum possible happiness.